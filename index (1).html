<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ACTFL Proficiency Pyramid (SDC Long Sequence Spanish)</title>
<style>
:root{--bg:#0b1020;--text:#e9eefc;--muted:#a9b6e6;--border:rgba(255,255,255,.12);--shadow:0 20px 60px rgba(0,0,0,.45);--radius:16px;
--sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;--mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}
html,body{height:100%;margin:0;font-family:var(--sans);color:var(--text);
background:radial-gradient(1200px 800px at 20% 0%,#16265a 0%,var(--bg) 45%,#070a14 100%);}
.app{display:grid;grid-template-columns:minmax(340px,1fr) minmax(340px,1fr);gap:16px;padding:16px;box-sizing:border-box;}
.card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border:1px solid var(--border);
border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;}
.topbar{display:flex;gap:10px;align-items:center;padding:12px;border-bottom:1px solid var(--border);background:rgba(0,0,0,.18);flex-wrap:wrap;}
select,button{background:rgba(255,255,255,.06);border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:12px;font-size:14px;outline:none;}
button{cursor:pointer;}button:hover{background:rgba(255,255,255,.10);}
.hint{color:var(--muted);font-size:12px;margin-left:auto;}
.stageWrap{padding:18px;height:520px;box-sizing:border-box;display:flex;justify-content:center;align-items:center;}
.right .panel{padding:14px;}
.h1{font-size:18px;font-weight:800;margin:2px 0 6px;}
.sub{color:var(--muted);font-size:13px;margin:0 0 10px;}
.pillrow{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 12px;}
.pill{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.06);}
.pill b{font-family:var(--mono);}
.box{background:rgba(0,0,0,.16);border:1px solid var(--border);border-radius:14px;padding:12px;margin-top:10px;}
.box h3{margin:0 0 8px;font-size:13px;color:var(--muted);letter-spacing:.02em;text-transform:uppercase;}
.desc{line-height:1.45;font-size:14px;}
table{width:100%;border-collapse:separate;border-spacing:0;font-size:13px;margin-top:8px;}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.08);vertical-align:top;}
th{color:var(--muted);font-weight:700;text-align:left;}
tr:last-child td{border-bottom:none;}
.status{font-weight:800;}
.muted{color:var(--muted);}
.slice{cursor:pointer;transition:filter .12s ease,transform .12s ease;transform-origin:center;}
.slice:hover{filter:brightness(1.10);}
.slice.selected{filter:brightness(1.18) drop-shadow(0 10px 16px rgba(0,0,0,.35));}
.labelText{font-size:12px;fill:rgba(255,255,255,.92);font-weight:700;}
.codeText{font-family:var(--mono);font-size:11px;fill:rgba(255,255,255,.85);}
@media (max-width:980px){.app{grid-template-columns:1fr;}.stageWrap{height:440px;}.hint{margin-left:0;width:100%;}}
</style>
</head>
<body>
<div class="app">
  <div class="card">
    <div class="topbar">
      <select id="modeSelect"></select>
      <select id="skillSelect"></select>
      <button id="resetBtn">Reset</button>
      <div class="hint">Click a slice â€¢ Includes Interpretive Reading</div>
    </div>
    <div class="stageWrap">
      <svg id="pyramid" width="100%" height="100%" viewBox="0 0 520 520" role="img" aria-label="Proficiency pyramid">
        <defs>
          <linearGradient id="faceShine" x1="0" x2="1">
            <stop offset="0" stop-color="rgba(255,255,255,.10)"/>
            <stop offset="0.55" stop-color="rgba(255,255,255,.00)"/>
            <stop offset="1" stop-color="rgba(0,0,0,.18)"/>
          </linearGradient>
        </defs>
        <ellipse cx="260" cy="468" rx="150" ry="34" fill="rgba(27,44,107,.55)"/>
        <g id="slices"></g>
        <path d="" id="outline" fill="none" stroke="rgba(255,255,255,.14)" stroke-width="2"/>
      </svg>
    </div>
  </div>

  <div class="card right">
    <div class="panel">
      <div class="h1">ACTFL Proficiency Pyramid</div>
      <div class="sub">Select mode + skill, then click a slice to view descriptor and SDC expectations.</div>

      <div class="pillrow">
        <div class="pill">Selected: <b id="selCode">â€”</b></div>
        <div class="pill">Band: <span id="selBand" class="muted">â€”</span></div>
        <div class="pill">Mode: <span id="selMode" class="muted">â€”</span></div>
        <div class="pill">Skill: <span id="selSkill" class="muted">â€”</span></div>
      </div>

      <div class="box">
        <h3>ACTFL descriptor</h3>
        <div class="desc" id="actflDesc">Choose a slice.</div>
      </div>

      <div class="box">
        <h3>SDC Long Sequence expectation by course</h3>
        <div class="muted" style="font-size:12px;margin-bottom:8px;">Only courses with Entry/Target/Emerging markers at the selected slice are shown.</div>
        <div id="courseTableWrap" class="desc"></div>
      </div>

      <div class="box">
        <h3>Legend</h3>
        <div class="desc">ðŸŒ± <b>Entry</b> â€¢ ðŸŒ¿ <b>Target</b> â€¢ ðŸŒ³ <b>Emerging</b></div>
      </div>
    </div>
  </div>
</div>

<script>
const DATA = {"Interpretive Communication": {"Interpretive Listening â€“ Full Spectrum": {"descriptors": {"N1": "Recognizes isolated words and memorized phrases with strong contextual support.", "N2": "Understands main ideas and isolated details in short, familiar audio texts.", "N3": null, "N4": "Follows simple spoken messages beyond rehearsed material with partial comprehension.", "I1": "Understands sentence-length spoken language on everyday topics.", "I2": "Understands connected spoken discourse with predictable structure.", "I3": null, "I4": null, "I5": "Understands most conversations on familiar topics, including narration and description.", "A1": "Understands paragraph-length spoken discourse across time frames.", "A2": "Understands detailed spoken texts on personal and public topics.", "A3": "Understands extended discourse with nuance and detail across contexts."}, "grades": {"1st Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "2nd Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "3rd Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "4th Grade": {"N1": "ðŸŒ± Entry", "N2": "ðŸŒ¿ Target", "N3": "ðŸŒ³ Emerging"}, "5th Grade": {"N3": "ðŸŒ± Entry", "N4": "ðŸŒ¿ Target", "I1": "ðŸŒ³ Emerging"}, "6th Grade": {"N3": "ðŸŒ± Entry", "N4": "ðŸŒ¿ Target", "I1": "ðŸŒ³ Emerging"}, "7th Grade": {"N4": "ðŸŒ± Entry", "I1": "ðŸŒ¿ Target", "I2": "ðŸŒ³ Emerging"}, "8th Grade": {"N4": "ðŸŒ± Entry", "I1": "ðŸŒ¿ Target", "I2": "ðŸŒ³ Emerging"}, "Honors Spanish I": {"I2": "ðŸŒ± Entry", "I3": "ðŸŒ¿ Target", "I4": "ðŸŒ³ Emerging"}, "9th Grade Honors": {"I3": "ðŸŒ± Entry", "I4": "ðŸŒ¿ Target", "I5": "ðŸŒ³ Emerging"}, "Honors Spanish II": {"I4": "ðŸŒ± Entry", "I5": "ðŸŒ¿ Target", "A1": "ðŸŒ³ Emerging"}}}, "Interpretive Reading â€“ Full Spectrum": {"descriptors": {"N1": "Identifies familiar words, symbols, and cognates in isolation.", "N2": "Understands short, simple texts on familiar topics using context and visuals.", "N3": null, "N4": "Grasps the gist of short paragraph-length texts when scaffolded.", "I1": "Understands sentence-level texts across everyday contexts.", "I2": "Understands connected texts with organization and supporting detail.", "I3": null, "I4": null, "I5": "Understands narrations and descriptions in familiar genres.", "A1": "Understands paragraph-length texts across time frames.", "A2": "Understands detailed, organized texts on personal and public topics.", "A3": "Understands extended texts with nuance and perspective."}, "grades": {"1st Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "2nd Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "3rd Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "4th Grade": {"N1": "ðŸŒ± Entry", "N2": "ðŸŒ¿ Target", "N3": "ðŸŒ³ Emerging"}, "5th Grade": {"N2": "ðŸŒ± Entry", "N3": "ðŸŒ¿ Target", "N4": "ðŸŒ³ Emerging"}, "6th Grade": {"N3": "ðŸŒ± Entry", "N4": "ðŸŒ¿ Target", "I1": "ðŸŒ³ Emerging"}, "7th Grade": {"N4": "ðŸŒ± Entry", "I1": "ðŸŒ¿ Target", "I2": "ðŸŒ³ Emerging"}, "8th Grade": {"N4": "ðŸŒ± Entry", "I1": "ðŸŒ¿ Target", "I2": "ðŸŒ³ Emerging"}, "Honors Spanish I": {"I2": "ðŸŒ± Entry", "I3": "ðŸŒ¿ Target", "I4": "ðŸŒ³ Emerging"}, "9th Grade Honors": {"I3": "ðŸŒ± Entry", "I4": "ðŸŒ¿ Target", "I5": "ðŸŒ³ Emerging"}, "Honors Spanish II": {"I4": "ðŸŒ± Entry", "I5": "ðŸŒ¿ Target", "A1": "ðŸŒ³ Emerging"}}}}, "Interpersonal Communication": {"Interpersonal Oral Interaction â€“ Full Spectrum": {"descriptors": {"N1": "Exchanges meaning using isolated words and memorized phrases, relying heavily on repetition, gestures, and support. Understanding and responses are limited and often fragmented.", "N2": "Participates in simple, predictable exchanges using short sentences. Understands and responds to direct questions related to self and immediate environment, though interaction is often reactive.", "N3": null, "N4": "Manages uncomplicated conversations by asking and answering simple questions. Begins to recombine language and repair breakdowns, but cannot yet sustain interaction consistently.", "I1": "Creates with language to handle everyday interactions and transactions. Can initiate, maintain, and close simple conversations across familiar contexts.", "I2": "Sustains interaction using strings of sentences. Can exchange information, clarify meaning, and maintain conversations on familiar topics with increased independence.", "I3": null, "I4": null, "I5": "Participates in conversations with emerging narration and description, but performance is not yet consistently paragraph-length.", "A1": "Sustains paragraph-length interaction, narrating and describing in past, present, and future time frames. Can handle situations with a complication.", "A2": "Engages confidently in extended conversations with detail, organization, and clarity, interweaving narration and description.", "A3": "Communicates with ease, precision, and fluency across contexts, adapting language to the interaction and interlocutor."}, "grades": {"1st Grade": {"N1": "ðŸŒ³ Emerging"}, "2nd Grade": {"N1": "ðŸŒ³ Emerging"}, "3rd Grade": {"N1": "ðŸŒ³ Emerging"}, "4th Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "5th Grade": {"N1": "ðŸŒ± Entry", "N2": "ðŸŒ¿ Target", "N3": "ðŸŒ³ Emerging"}, "6th Grade": {"N2": "ðŸŒ± Entry", "N3": "ðŸŒ¿ Target", "N4": "ðŸŒ³ Emerging"}, "7th Grade": {"N3": "ðŸŒ± Entry", "N4": "ðŸŒ¿ Target", "I1": "ðŸŒ³ Emerging"}, "8th Grade": {"N3": "ðŸŒ± Entry", "N4": "ðŸŒ¿ Target", "I1": "ðŸŒ³ Emerging"}, "Honors Spanish I": {"N4": "ðŸŒ± Entry", "I1": "ðŸŒ¿ Target", "I2": "ðŸŒ³ Emerging"}, "9th Grade Honors": {"I1": "ðŸŒ± Entry", "I2": "ðŸŒ¿ Target", "I3": "ðŸŒ³ Emerging"}, "Honors Spanish II": {"I2": "ðŸŒ± Entry", "I3": "ðŸŒ¿ Target", "I4": "ðŸŒ³ Emerging"}}}, "Interpersonal Written Interaction â€“ Full Spectrum": {"descriptors": {"N1": "Exchanges meaning by copying or reproducing familiar words and phrases. Relies heavily on models and may switch to another language to maintain interaction.", "N2": "Participates in simple written exchanges using short, practiced sentences. Can read and respond to highly predictable messages on familiar topics.", "N3": null, "N4": "Manages basic written interactions by asking and answering simple questions and recombining familiar language, though exchanges remain short and uneven.", "I1": "Creates with language in written exchanges to meet everyday needs. Can maintain back-and-forth communication using connected sentences.", "I2": "Sustains written interaction using strings of sentences, clarifying meaning and exchanging information across familiar contexts.", "I3": null, "I4": null, "I5": "Participates in written exchanges with emerging paragraph-level organization, though breakdowns may occur when complexity increases.", "A1": "Sustains paragraph-length written interaction, narrating and describing across time frames in exchanges.", "A2": "Engages in extended written interaction with detail, cohesion, and clarity, adjusting language to context and audience.", "A3": "Writes interactively with precision, nuance, and stylistic control, maintaining coherent and purposeful exchanges across contexts."}, "grades": {"1st Grade": {"N1": "ðŸŒ³ Emerging"}, "2nd Grade": {"N1": "ðŸŒ³ Emerging"}, "3rd Grade": {"N1": "ðŸŒ³ Emerging"}, "4th Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "5th Grade": {"N1": "ðŸŒ± Entry", "N2": "ðŸŒ¿ Target", "N3": "ðŸŒ³ Emerging"}, "6th Grade": {"N2": "ðŸŒ± Entry", "N3": "ðŸŒ¿ Target", "N4": "ðŸŒ³ Emerging"}, "7th Grade": {"N4": "ðŸŒ± Entry", "I1": "ðŸŒ¿ Target", "I2": "ðŸŒ³ Emerging"}, "8th Grade": {"N4": "ðŸŒ± Entry", "I1": "ðŸŒ¿ Target", "I2": "ðŸŒ³ Emerging"}, "Honors Spanish I": {"I1": "ðŸŒ± Entry", "I2": "ðŸŒ¿ Target", "I3": "ðŸŒ³ Emerging"}, "9th Grade Honors": {"I2": "ðŸŒ± Entry", "I3": "ðŸŒ¿ Target", "I4": "ðŸŒ³ Emerging"}, "Honors Spanish II": {"I3": "ðŸŒ± Entry", "I4": "ðŸŒ¿ Target", "I5": "ðŸŒ³ Emerging"}}}}, "Presentational Communication": {"Presentational Speaking â€“ Full Spectrum": {"descriptors": {"N1": "Produces lists and memorized phrases.", "N2": "Presents basic information using short sentences on familiar topics.", "N3": null, "N4": "Produces connected sentences to express personal meaning.", "I1": "Creates with language to present on everyday topics.", "I2": "Sustains organized presentations using sentence strings.", "I3": null, "I4": null, "I5": "Presents with emerging paragraph-level organization.", "A1": "Produces paragraph-length presentations across time frames.", "A2": "Produces detailed, organized presentations on personal and public topics.", "A3": "Presents with clarity, precision, and rhetorical control."}, "grades": {"1st Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "2nd Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "3rd Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "4th Grade": {"N1": "ðŸŒ± Entry", "N2": "ðŸŒ¿ Target", "N3": "ðŸŒ³ Emerging"}, "5th Grade": {"N2": "ðŸŒ± Entry", "N3": "ðŸŒ¿ Target", "N4": "ðŸŒ³ Emerging"}, "6th Grade": {"N3": "ðŸŒ± Entry", "N4": "ðŸŒ¿ Target", "I1": "ðŸŒ³ Emerging"}, "7th Grade": {"N4": "ðŸŒ± Entry", "I1": "ðŸŒ¿ Target", "I2": "ðŸŒ³ Emerging"}, "8th Grade": {"N4": "ðŸŒ± Entry", "I1": "ðŸŒ¿ Target", "I2": "ðŸŒ³ Emerging"}, "Honors Spanish I": {"I2": "ðŸŒ± Entry", "I3": "ðŸŒ¿ Target", "I4": "ðŸŒ³ Emerging"}, "9th Grade Honors": {"I3": "ðŸŒ± Entry", "I4": "ðŸŒ¿ Target", "I5": "ðŸŒ³ Emerging"}, "Honors Spanish II": {"I4": "ðŸŒ± Entry", "I5": "ðŸŒ¿ Target", "A1": "ðŸŒ³ Emerging"}}}, "Presentational Writing â€“ Full Spectrum": {"descriptors": {"N1": "Copies or reproduces words and phrases.", "N2": "Writes simple sentences and short messages on familiar topics.", "N3": null, "N4": "Begins short paragraph-like writing through recombination.", "I1": "Writes connected sentences to communicate meaning.", "I2": "Writes organized texts using sentence strings.", "I3": null, "I4": null, "I5": "Writes with emerging paragraph structure and narration.", "A1": "Writes paragraph-length texts across time frames.", "A2": "Writes detailed, organized texts with cohesion and clarity.", "A3": "Writes with precision, nuance, and stylistic control."}, "grades": {"1st Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "2nd Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "3rd Grade": {"N1": "ðŸŒ¿ Target", "N2": "ðŸŒ³ Emerging"}, "4th Grade": {"N1": "ðŸŒ± Entry", "N2": "ðŸŒ¿ Target", "N3": "ðŸŒ³ Emerging"}, "5th Grade": {"N2": "ðŸŒ± Entry", "N3": "ðŸŒ¿ Target", "N4": "ðŸŒ³ Emerging"}, "6th Grade": {"N3": "ðŸŒ± Entry", "N4": "ðŸŒ¿ Target", "I1": "ðŸŒ³ Emerging"}, "7th Grade": {"N4": "ðŸŒ± Entry", "I1": "ðŸŒ¿ Target", "I2": "ðŸŒ³ Emerging"}, "8th Grade": {"N4": "ðŸŒ± Entry", "I1": "ðŸŒ¿ Target", "I2": "ðŸŒ³ Emerging"}, "Honors Spanish I": {"I2": "ðŸŒ± Entry", "I3": "ðŸŒ¿ Target", "I4": "ðŸŒ³ Emerging"}, "9th Grade Honors": {"I3": "ðŸŒ± Entry", "I4": "ðŸŒ¿ Target", "I5": "ðŸŒ³ Emerging"}, "Honors Spanish II": {"I4": "ðŸŒ± Entry", "I5": "ðŸŒ¿ Target", "A1": "ðŸŒ³ Emerging"}}}}};
const SLICE_ORDER = ["N1", "N2", "N3", "N4", "I1", "I2", "I3", "I4", "I5", "A1", "A2", "A3"];
const LABELS = {"N1": "Novice Low", "N2": "Novice Mid", "N3": "Novice Mid", "N4": "Novice High", "I1": "Intermediate Low", "I2": "Intermediate Mid", "I3": "Intermediate Mid", "I4": "Intermediate High", "I5": "Intermediate High", "A1": "Advanced Low", "A2": "Advanced Mid", "A3": "Advanced High"};
const COLORS = {"Novice": "#2f6fdf", "Intermediate": "#3aa85a", "Advanced": "#e07a2f"};

const modeSelect = document.getElementById('modeSelect');
const skillSelect = document.getElementById('skillSelect');
const resetBtn = document.getElementById('resetBtn');

const selCode = document.getElementById('selCode');
const selBand = document.getElementById('selBand');
const selMode = document.getElementById('selMode');
const selSkill = document.getElementById('selSkill');
const actflDesc = document.getElementById('actflDesc');
const courseTableWrap = document.getElementById('courseTableWrap');

const slicesG = document.getElementById('slices');
const outline = document.getElementById('outline');

function bandOf(code){
  if(code && code.startsWith('N')) return 'Novice';
  if(code && code.startsWith('I')) return 'Intermediate';
  if(code && code.startsWith('A')) return 'Advanced';
  return 'â€”';
}
function clearChildren(el){ while(el.firstChild) el.removeChild(el.firstChild); }

function buildSelectors(){
  clearChildren(modeSelect);
  const modes = Object.keys(DATA);
  modes.forEach(m=>{
    const opt=document.createElement('option');
    opt.value=m; opt.textContent=m;
    modeSelect.appendChild(opt);
  });
  modeSelect.value = modes[0];
  loadSkills();
}

function loadSkills(){
  clearChildren(skillSelect);
  const m = modeSelect.value;
  const skills = Object.keys(DATA[m]);
  skills.forEach(s=>{
    const opt=document.createElement('option');
    opt.value=s;
    opt.textContent=s.replace('â€“ Full Spectrum','').trim();
    skillSelect.appendChild(opt);
  });
  // Prefer Interpretive Reading if present, so you can confirm it's there
  const pref = skills.find(s=>s.toLowerCase().includes('reading')) || skills[0];
  skillSelect.value = pref;
}

let selectedCode = null;

function buildPyramid(){
  clearChildren(slicesG);
  selectedCode = null;
  updatePanel(null);

  const topW = 340, bottomW = 54;
  const topY = 56, bottomY = 446;
  const cx = 260;
  const n = SLICE_ORDER.length;
  const h = (bottomY - topY) / n;

  function widthAt(i){
    const t = i / n;
    return bottomW + (topW - bottomW) * t;
  }

  const leftTop = cx - topW/2, rightTop = cx + topW/2;
  const leftBot = cx - bottomW/2, rightBot = cx + bottomW/2;
  outline.setAttribute('d', 'M '+leftTop+' '+topY+' L '+rightTop+' '+topY+' L '+rightBot+' '+bottomY+' L '+leftBot+' '+bottomY+' Z');

  for(let i=0;i<n;i++){
    const code = SLICE_ORDER[i];
    const y0 = topY + i*h;
    const y1 = topY + (i+1)*h;
    const w0 = widthAt(i);
    const w1 = widthAt(i+1);
    const x0L = cx - w0/2, x0R = cx + w0/2;
    const x1L = cx - w1/2, x1R = cx + w1/2;

    const band = bandOf(code);
    const base = COLORS[band] || '#999';

    const poly = document.createElementNS('http://www.w3.org/2000/svg','polygon');
    poly.setAttribute('points', x0L+','+y0+' '+x0R+','+y0+' '+x1R+','+y1+' '+x1L+','+y1);
    poly.setAttribute('fill', base);
    poly.setAttribute('opacity','0.96');
    poly.setAttribute('class','slice');
    poly.dataset.code = code;

    const shine = document.createElementNS('http://www.w3.org/2000/svg','polygon');
    shine.setAttribute('points', x0L+','+y0+' '+x0R+','+y0+' '+x1R+','+y1+' '+x1L+','+y1);
    shine.setAttribute('fill','url(#faceShine)');
    shine.setAttribute('opacity','0.65');
    shine.style.pointerEvents = 'none';

    const txt = document.createElementNS('http://www.w3.org/2000/svg','text');
    txt.setAttribute('x', cx);
    txt.setAttribute('y', y0 + h*0.62);
    txt.setAttribute('text-anchor','middle');
    txt.setAttribute('class','labelText');
    txt.textContent = LABELS[code] || code;

    const codeTxt = document.createElementNS('http://www.w3.org/2000/svg','text');
    codeTxt.setAttribute('x', cx);
    codeTxt.setAttribute('y', y0 + h*0.85);
    codeTxt.setAttribute('text-anchor','middle');
    codeTxt.setAttribute('class','codeText');
    codeTxt.textContent = code;

    slicesG.appendChild(poly);
    slicesG.appendChild(shine);
    slicesG.appendChild(txt);
    slicesG.appendChild(codeTxt);

    poly.addEventListener('click', ()=>selectSlice(code));
  }
}

function selectSlice(code){
  selectedCode = code;
  const polys = slicesG.querySelectorAll('polygon.slice');
  polys.forEach(p=>{
    p.classList.toggle('selected', p.dataset.code===code);
  });
  updatePanel(code);
}

function escapeHtml(s){
  return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
}

function updatePanel(code){
  const mode = modeSelect.value;
  const skill = skillSelect.value;

  selMode.textContent = mode;
  selSkill.textContent = skill.replace('â€“ Full Spectrum','').trim();

  if(!code){
    selCode.textContent = 'â€”';
    selBand.textContent = 'â€”';
    actflDesc.textContent = 'Choose a slice.';
    courseTableWrap.innerHTML = '<span class="muted">No slice selected.</span>';
    return;
  }

  selCode.textContent = code + ' (' + (LABELS[code] || code) + ')';
  selBand.textContent = bandOf(code);

  const obj = DATA[mode][skill];
  const desc = (obj.descriptors && obj.descriptors[code]) ? obj.descriptors[code] : null;
  actflDesc.textContent = desc ? desc : 'No descriptor listed for this slice in the attached framework.';

  const rows = [];
  const grades = obj.grades || {};
  Object.keys(grades).forEach(g=>{
    const status = grades[g][code];
    if(status) rows.push([g,status]);
  });

  if(!rows.length){
    courseTableWrap.innerHTML = '<span class="muted">No course markers at this slice.</span>';
    return;
  }

  let html = '<table><thead><tr><th style="width:52%;">Course / Grade</th><th>Status</th></tr></thead><tbody>';
  rows.forEach(r=>{
    html += '<tr><td>'+escapeHtml(r[0])+'</td><td class="status">'+escapeHtml(r[1])+'</td></tr>';
  });
  html += '</tbody></table>';
  courseTableWrap.innerHTML = html;
}

modeSelect.addEventListener('change', ()=>{ loadSkills(); buildPyramid(); });
skillSelect.addEventListener('change', ()=>{ updatePanel(selectedCode); });
resetBtn.addEventListener('click', ()=>{ selectedCode=null; buildPyramid(); });

buildSelectors();
buildPyramid();
</script>
</body>
</html>
